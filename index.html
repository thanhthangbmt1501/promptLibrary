<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Library</title>
    <style>
        body {
			font-family: Arial, sans-serif;
			display: flex;
			height: 100vh;
			margin: 0;
		}

		.sidebar {
			width: 30%;
			background: #f4f4f4;
			padding: 20px;
			overflow-y: auto;
			max-height: 100vh;
			position: relative;
			display: flex;
			flex-direction: column;
		}
		
		.copyright {
			order: 3; /* ƒê·∫∑t order l·ªõn h∆°n #prompt-list ƒë·ªÉ ƒë·∫©y xu·ªëng d∆∞·ªõi */
			text-align: center;
			font-size: 12px;
			color: #666;
			padding-top: 10px;
		}

		.button-group {
			display: flex;
			gap: 5px;
			justify-content: flex-start;
			flex-wrap: wrap;
			margin-bottom: 20px;
			order: 1; /* Gi·ªØ nguy√™n */
		}

		.content {
			flex: 1;
			padding: 20px;
			display: block;
		}

		.prompt-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			cursor: pointer;
			padding: 10px;
			border-bottom: 1px solid #ccc;
			position: relative;
		}

		.prompt-item:hover .actions {
			display: flex;
		}

		.actions {
			display: none;
			gap: 5px;
		}

		.edit-btn, .delete-btn {
			background: none;
			border: none;
			cursor: pointer;
			font-size: 14px;
		}

		.copy-btn, .save-btn, .save-as-btn {
			margin-bottom: 10px;
			padding: 5px 10px;
			background: #007bff;
			color: white;
			border: none;
			cursor: pointer;
			display: block;
		}

		textarea, input {
			width: 100%;
			padding: 10px;
			font-size: 14px;
			margin-bottom: 10px;
		}
		
		textarea {
			overflow-y: auto; /* Cho ph√©p cu·ªôn d·ªçc */
			resize: vertical; /* Cho ph√©p thay ƒë·ªïi k√≠ch th∆∞·ªõc theo chi·ªÅu d·ªçc */
		}

		#new-content, #prompt-content {
			height: auto;
			resize: none;
		}

		.description, .tips {
			margin-bottom: 15px;
			font-size: 14px;
		}

		.tips {
			font-style: italic;
		}

		.editor {
			display: none;
			margin-top: 20px;
			border: 1px solid #ccc;
			padding: 10px;
		}

		/* === S·ª≠a l·ªói category === */
		.category-container {
			margin-bottom: 5px;
		}

		/* Category hi·ªÉn th·ªã ƒë√∫ng */
		.category {
			display: flex;
			justify-content: space-between;
			align-items: center;
			background-color: #e0e0e0;
			padding: 10px;
			border-radius: 5px;
			cursor: pointer;
			user-select: none;
			position: relative;
		}

		.category h4 {
			margin: 0;
			flex-grow: 1; /* Gi√∫p category title m·ªü r·ªông t·ª± nhi√™n */
		}

		/* Hi·ªáu ·ª©ng hover */
		.category:hover {
			background-color: #d0d0d0;
		}

		/* Hi·ªÉn th·ªã n√∫t ch·ªânh s·ª≠a v√† x√≥a khi hover */
		.category-actions {
			display: none;
			gap: 5px;
		}

		.category:hover .category-actions {
			display: flex;
		}

		.category .edit-btn, .category .delete-btn {
			background: none;
			border: none;
			cursor: pointer;
			font-size: 14px;
		}

		/* === Danh s√°ch Prompt === */
		.category-items {
			padding-left: 15px; /* Th·ª•t l·ªÅ danh s√°ch prompt */
			display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
		}

		.prompt-item {
			padding: 8px;
			border-bottom: 1px solid #ccc;
			cursor: pointer;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		/* Hi·ªÉn th·ªã actions khi hover v√†o prompt */
		.prompt-item:hover .actions {
			display: flex;
		}

		/* Hover v√†o prompt */
		.prompt-item:hover {
			background-color: #f0f0f0;
		}

		.overview {
			margin-bottom: 15px;
			font-size: 14px;
			color: #333;
			line-height: 1.5; /* TƒÉng kho·∫£ng c√°ch d√≤ng cho d·ªÖ ƒë·ªçc */
		}
		
		.overview h4 {
			font-size: 16px;
			color: #007bff; /* M√†u xanh ƒë·ªÉ n·ªïi b·∫≠t */
			margin-top: 15px;
			margin-bottom: 10px;
		}

		.overview p {
			margin: 0 0 10px 0;
		}

		.overview ul, .overview ol {
			margin: 0 0 15px 20px; /* Th·ª•t ƒë·∫ßu d√≤ng */
			padding-left: 0;
		}

		.overview li {
			margin-bottom: 8px; /* Kho·∫£ng c√°ch gi·ªØa c√°c m·ª•c */
		}

		.overview strong {
			color: #333; /* L√†m n·ªïi b·∫≠t ph·∫ßn in ƒë·∫≠m */
			font-weight: 600;
		}
		
		#introduction {
			margin-bottom: 15px;
			font-size: 14px;
			color: #333;
		}
		
		.button-group-row {
			display: flex;
			gap: 10px;
			margin-top: 10px;
		}

		.hidden {
			display: none;
		}
		
		#prompt-content {
			width: 100%;
			padding: 10px;
			font-size: 14px;
			resize: none;
			overflow-y: hidden; /* ·∫®n thanh cu·ªôn */
			max-height: none; /* Kh√¥ng gi·ªõi h·∫°n chi·ªÅu cao */
		}



		
		.sidebar img {
			transition: transform 0.3s ease; /* Hi·ªáu ·ª©ng m∆∞·ª£t khi hover */
		}

		.sidebar img:hover {
			transform: scale(1.1); /* Ph√≥ng to nh·∫π khi hover */
		}
		
		.logo-fixed {
			position: fixed;
			top: 0px;
			left: 10px;
			z-index: 1000; /* ƒê·∫£m b·∫£o logo n·∫±m tr√™n c√°c ph·∫ßn t·ª≠ kh√°c */
		}
		
		.logo {			
			height: 40px;
			transition: transform 0.3s ease;
		}
		
		.logo:hover {
			transform: scale(1.1); /* Ph√≥ng to nh·∫π khi hover */
		}

		.header-container {
			display: flex;
			align-items: center;
			gap: 20px;
			margin-bottom: 10px;
		}
		
		#prompt-list {
			order: 2; /* Gi·ªØ nguy√™n */
			flex-grow: 1; /* Gi·ªØ nguy√™n */
			overflow-y: auto;
		}
    </style>
</head>
<body>
	<div class="sidebar">
		<div class="header-container">
			<img src="https://raw.githubusercontent.com/thanhthangbmt1501/AIExploration/main/LOGO_UDA_2023_VN_EN_chuan.png" alt="Logo" class="logo" style="height: 40px;">
			<h3>Th∆∞ Vi·ªán Prompt Cho Gi·∫£ng Vi√™n V√† Sinh Vi√™n</h3>
		</div>
		<div class="button-group">
			<button onclick="updatePromptsFromOnline()">üìö PromptLib</button>
			<button onclick="exportPrompts()">üì§ Export</button>
			<button onclick="document.getElementById('import-file').click()">üì• Import</button>
			<input type="file" id="import-file" style="display: none;" onchange="importPrompts(event)">
			<button onclick="openNewCategoryModal()">üìÇ New Category</button>
			<button onclick="openNewPromptEditor()">üìù New Prompt</button>
		</div>
		<div id="prompt-list"></div>
		<div class="copyright" style="margin-top: auto; text-align: center; font-size: 12px; color: #666;">
			Copyright ¬© Khoa CNTT Tr∆∞·ªùng ƒêH ƒê√¥ng √Å - Th√°ng 3/2025
		</div>
	</div>

    <div class="content" id="content-section">
		<div id="introduction">
			<h3>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Th∆∞ Vi·ªán Prompt AI</h3>
			<p>Th∆∞ Vi·ªán Prompt AI l√† m·ªôt c√¥ng c·ª• m·∫°nh m·∫Ω ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ h·ªó tr·ª£ ng∆∞·ªùi d√πng ‚Äì t·ª´ gi·∫£ng vi√™n, sinh vi√™n ƒë·∫øn nh·ªØng nh√† s√°ng t·∫°o n·ªôi dung ‚Äì trong vi·ªác x√¢y d·ª±ng, qu·∫£n l√Ω v√† t·∫≠n d·ª•ng t·ªëi ƒëa c√°c prompt ƒë∆∞·ª£c t·ªëi ∆∞u h√≥a b·∫±ng tr√≠ tu·ªá nh√¢n t·∫°o. V·ªõi hai danh m·ª•c ch√≠nh l√† "H·ªó Tr·ª£ Gi·∫£ng Vi√™n T·∫°o T√†i Li·ªáu Gi·∫£ng D·∫°y" v√† "H·ªó Tr·ª£ Sinh Vi√™n H·ªçc T·∫≠p", th∆∞ vi·ªán mang ƒë·∫øn h√†ng lo·∫°t c√¥ng c·ª• ƒëa d·∫°ng, t·ª´ vi·ªác thi·∫øt k·∫ø k·∫ø ho·∫°ch b√†i d·∫°y chi ti·∫øt, slide b√†i gi·∫£ng tr·ª±c quan, ƒë·∫øn c√°c k·ªãch b·∫£n m√¥ ph·ªèng th·ª±c t·∫ø v√† b√†i t·∫≠p luy·ªán t·∫≠p s√°ng t·∫°o, t·∫•t c·∫£ ƒë·ªÅu ƒë∆∞·ª£c t√πy ch·ªânh ƒë·ªÉ ƒë√°p ·ª©ng chu·∫©n ƒë·∫ßu ra (CƒêR) v√† ph√π h·ª£p v·ªõi tr√¨nh ƒë·ªô ng∆∞·ªùi h·ªçc. <br><br> Kh√¥ng d·ª´ng l·∫°i ·ªü ƒë√≥, th∆∞ vi·ªán c√≤n ƒë√≥ng vai tr√≤ nh∆∞ m·ªôt ng∆∞·ªùi b·∫°n ƒë·ªìng h√†nh, cung c·∫•p h∆∞·ªõng d·∫´n c√° nh√¢n h√≥a, ph·∫£n h·ªìi chi ti·∫øt, v√† c√°c gi·∫£i ph√°p th·ª±c h√†nh th·ª±c t·∫ø nh·∫±m n√¢ng cao k·ªπ nƒÉng t·ª± h·ªçc, t∆∞ duy ph·∫£n bi·ªán, c≈©ng nh∆∞ kh·∫£ nƒÉng l√†m vi·ªác nh√≥m c·ªßa sinh vi√™n. H√£y kh√°m ph√° c√°c danh m·ª•c trong thanh b√™n ƒë·ªÉ tr·∫£i nghi·ªám c√°ch AI c√≥ th·ªÉ bi·∫øn qu√° tr√¨nh gi·∫£ng d·∫°y, h·ªçc t·∫≠p v√† s√°ng t·∫°o n·ªôi dung c·ªßa b·∫°n tr·ªü n√™n hi·ªáu qu·∫£ v√† th√∫ v·ªã h∆°n bao gi·ªù h·∫øt!</p>
		</div>
		<h3 id="prompt-title" class="hidden">The prompt</h3>
		<div id="category-overview" class="overview hidden"></div>
		<p id="prompt-description" class="description hidden">Click on a prompt to view its details.</p>
		<p id="prompt-tips" class="tips hidden"></p>
		<div class="button-group-row hidden">
			<button class="copy-btn" onclick="copyPrompt()">Copy Prompt</button>
			<button class="save-as-btn" onclick="openSaveAsEditor()">Save As</button>
		</div>
		<textarea id="prompt-content" class="hidden"></textarea>
	</div>
    <div class="editor" id="editor-section">
		<h3>Add/Edit Prompt</h3>
		<label for="new-category">Category Name:</label>
		<select id="new-category">
			<option value="">-- Select a Category --</option>
		</select>
		<input type="text" id="new-title" placeholder="Prompt Title">
		<textarea id="new-description" placeholder="Prompt Description"></textarea>
		<textarea id="new-tips" placeholder="Prompt Tips"></textarea>
		<textarea id="new-content" placeholder="Prompt Content"></textarea>
		<button class="save-btn" onclick="savePrompt()">Save</button>
	</div>


    <script>
        const JSON_URL = "https://raw.githubusercontent.com/thanhthangbmt1501/promptLibrary/main/promptsCategory_v4a_05.03.2025.json";

		async function fetchAndStorePrompts() {
			let storedPrompts = localStorage.getItem("prompts");

			if (storedPrompts) {
				console.log("üü¢ ƒêang s·ª≠ d·ª•ng d·ªØ li·ªáu t·ª´ localStorage...");
				prompts = JSON.parse(storedPrompts);
				renderPrompts(); // Hi·ªÉn th·ªã d·ªØ li·ªáu ngay l·∫≠p t·ª©c
				return;
			}

			console.log("üîµ Ch∆∞a c√≥ d·ªØ li·ªáu trong localStorage, ƒëang t·∫£i t·ª´ JSON Online...");
			try {
				const response = await fetch(JSON_URL);
				if (!response.ok) throw new Error("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu t·ª´ PromptLib!");

				const data = await response.json();
				localStorage.setItem("prompts", JSON.stringify(data)); // L∆∞u v√†o localStorage
				prompts = data;
				renderPrompts(); // C·∫≠p nh·∫≠t giao di·ªán sau khi t·∫£i d·ªØ li·ªáu m·ªõi
			} catch (error) {
				console.error("üî¥ L·ªói khi t·∫£i Prompt t·ª´ JSON:", error);
				document.getElementById("prompt-list").innerText = "L·ªói khi t·∫£i d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.";
			}
		}


		let prompts = {};
		fetchAndStorePrompts(); // Ki·ªÉm tra localStorage v√† t·∫£i JSON n·∫øu c·∫ßn

		async function renderPrompts() {
			const list = document.getElementById("prompt-list");
			list.innerHTML = "";

			if (Object.keys(prompts).length === 0) {
				list.innerText = "Loading prompts...";
				return;
			}

			Object.keys(prompts).forEach(category => {
				const categoryContainer = document.createElement("div");
				categoryContainer.className = "category-container";

				const categoryDiv = document.createElement("div");
				categoryDiv.className = "category";
				categoryDiv.innerHTML = `
					<h4 onclick="toggleCategory('${category}')">${category} üìÇ</h4>
					<span class="category-actions">
						<button class="edit-btn" onclick="editCategory(event, '${category}')">‚úèÔ∏è</button>
						<button class="delete-btn" onclick="deleteCategory(event, '${category}')">‚ùå</button>
					</span>
				`;

				const categoryList = document.createElement("div");
				categoryList.className = "category-items";
				categoryList.id = `category-${category}`;
				categoryList.style.display = "none";

				Object.keys(prompts[category]).forEach(promptName => {
					if (promptName !== "categoryOverview") {
						const div = document.createElement("div");
						div.className = "prompt-item";
						div.innerHTML = `${promptName} 
							<span class="actions">
								<button class="edit-btn" onclick="editPrompt(event, '${category}', '${promptName}')">‚úèÔ∏è</button>
								<button class="delete-btn" onclick="deletePrompt(event, '${category}', '${promptName}')">‚ùå</button>
							</span>`;
						div.onclick = () => showPrompt(category, promptName);
						categoryList.appendChild(div);
					}
				});

				categoryContainer.appendChild(categoryDiv);
				categoryContainer.appendChild(categoryList);
				list.appendChild(categoryContainer);
			});
		}
        

		function exportPrompts() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(prompts));
            const downloadAnchor = document.createElement("a");
            downloadAnchor.setAttribute("href", dataStr);
            downloadAnchor.setAttribute("download", "prompts.json");
            document.body.appendChild(downloadAnchor);
            downloadAnchor.click();
            document.body.removeChild(downloadAnchor);
        }

        function importPrompts(event) {
			const file = event.target.files[0];
			if (!file) return;

			const reader = new FileReader();
			reader.onload = function(e) {
				try {
					const importedData = JSON.parse(e.target.result);
					let storedPrompts = localStorage.getItem("prompts");
					let currentPrompts = storedPrompts ? JSON.parse(storedPrompts) : {};

					let updated = false;

					// Duy·ªát qua t·ª´ng category trong file JSON
					Object.keys(importedData).forEach(category => {
						if (!currentPrompts[category]) {
							// N·∫øu category ch∆∞a t·ªìn t·∫°i, th√™m m·ªõi
							currentPrompts[category] = importedData[category];
							updated = true;
						} else {
							// N·∫øu category ƒë√£ t·ªìn t·∫°i, c·∫≠p nh·∫≠t c√°c prompt
							Object.keys(importedData[category]).forEach(promptKey => {
								currentPrompts[category][promptKey] = importedData[category][promptKey];
								updated = true;
							});
						}
					});

					if (updated) {
						localStorage.setItem("prompts", JSON.stringify(currentPrompts)); // L∆∞u v√†o localStorage
						prompts = currentPrompts; // C·∫≠p nh·∫≠t bi·∫øn to√†n c·ª•c
						renderPrompts(); // C·∫≠p nh·∫≠t giao di·ªán
						alert("Import th√†nh c√¥ng! D·ªØ li·ªáu m·ªõi ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t.");
					} else {
						alert("Kh√¥ng c√≥ thay ƒë·ªïi n√†o khi import.");
					}
				} catch (error) {
					alert("L·ªói khi ƒë·ªçc file. H√£y ƒë·∫£m b·∫£o file JSON h·ª£p l·ªá.");
					console.error("Error importing prompts:", error);
				}
			};

			reader.readAsText(file);
		}
	       


		function editCategory(event, oldCategory) {
			event.stopPropagation(); // NgƒÉn kh√¥ng cho m·ªü/ƒë√≥ng category khi ch·ªânh s·ª≠a

			const newCategory = prompt("Nh·∫≠p t√™n m·ªõi cho category:", oldCategory);
			if (newCategory && newCategory !== oldCategory) {
				if (prompts[newCategory]) {
					alert("Category n√†y ƒë√£ t·ªìn t·∫°i!");
					return;
				}
				// C·∫≠p nh·∫≠t danh s√°ch prompts
				prompts[newCategory] = prompts[oldCategory];
				delete prompts[oldCategory];

				localStorage.setItem("prompts", JSON.stringify(prompts));
				renderPrompts();
			}
		}
		
		function deleteCategory(event, category) {
			event.stopPropagation(); // NgƒÉn kh√¥ng cho m·ªü/ƒë√≥ng category khi x√≥a

			if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a category "${category}" v√† t·∫•t c·∫£ prompts b√™n trong?`)) {
				delete prompts[category];

				localStorage.setItem("prompts", JSON.stringify(prompts));
				renderPrompts();
			}
		}


		function toggleCategory(category) {
			const categoryItems = document.getElementById(`category-${category}`);

			document.querySelectorAll(".category-items").forEach(item => {
				if (item !== categoryItems) {
					item.style.display = "none";
				}
			});

			if (categoryItems.style.display === "block") {
				categoryItems.style.display = "none";
				document.getElementById('content-section').style.display = "none";
				document.getElementById('introduction').classList.remove("hidden");
			} else {
				categoryItems.style.display = "block";
				document.getElementById('content-section').style.display = "block";
				document.getElementById('introduction').classList.add("hidden");
				document.getElementById('prompt-title').innerText = category;

				// L·∫•y n·ªôi dung t·ª´ JSON
				const overviewText = prompts[category]?.categoryOverview || "No overview available.";

				// Chuy·ªÉn ƒë·ªïi n·ªôi dung th√†nh HTML
				const formattedOverview = formatOverview(overviewText);
				document.getElementById('category-overview').innerHTML = formattedOverview;
				document.getElementById('category-overview').classList.remove("hidden");

				document.getElementById('prompt-description').classList.add("hidden");
				document.getElementById('prompt-tips').classList.add("hidden");
				document.querySelector('.button-group-row').classList.add("hidden");
				document.getElementById('prompt-content').classList.add("hidden");
			}
		}
		
		// H√†m x·ª≠ l√Ω ƒë·ªãnh d·∫°ng n·ªôi dung t·ª´ JSON
		function formatOverview(text) {
			const sections = text.split('\n\n');
			let html = '';

			sections.forEach(section => {
				// X·ª≠ l√Ω ti√™u ƒë·ªÅ ph·ª• ƒë·ªôc l·∫≠p (b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c b·∫±ng **)
				if (section.startsWith('**') && section.endsWith('**')) {
					const title = section.replace(/\*\*/g, '').trim();
					html += `<h4>${title}</h4>`;
				} 
				// X·ª≠ l√Ω danh s√°ch g·∫°ch ƒë·∫ßu d√≤ng
				else if (section.includes('\n- ')) {
					const items = section.split('\n- ').filter(item => item.trim());
					if (items.length > 0) {
						let inList = false;
						items.forEach((item, index) => {
							const trimmedItem = item.trim();
							// N·∫øu l√† m·ª•c ƒë·∫ßu ti√™n kh√¥ng b·∫Øt ƒë·∫ßu b·∫±ng **, coi nh∆∞ ƒëo·∫°n d·∫´n
							if (index === 0 && !trimmedItem.startsWith('**')) {
								html += `<p>${trimmedItem}</p>`;
							} else {
								// Ki·ªÉm tra n·∫øu m·ª•c l√† ti√™u ƒë·ªÅ ph·ª• (**...**:)
								if (trimmedItem.startsWith('**') && trimmedItem.endsWith(':**')) {
									if (inList) {
										html += '</ul>'; // ƒê√≥ng danh s√°ch tr∆∞·ªõc n·∫øu ƒëang m·ªü
										inList = false;
									}
									const title = trimmedItem.replace(/\*\*/g, '').replace(/:$/, '').trim();
									html += `<h4>${title}</h4>`;
								} else {
									// N·∫øu kh√¥ng ph·∫£i ti√™u ƒë·ªÅ ph·ª•, b·∫Øt ƒë·∫ßu ho·∫∑c ti·∫øp t·ª•c danh s√°ch
									if (!inList) {
										html += '<ul>';
										inList = true;
									}
									const formattedItem = trimmedItem.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
									html += `<li>${formattedItem}</li>`;
								}
							}
						});
						if (inList) {
							html += '</ul>'; // ƒê√≥ng danh s√°ch sau khi ho√†n t·∫•t
						}
					}
				} 
				// X·ª≠ l√Ω danh s√°ch s·ªë th·ª© t·ª±
				else if (section.includes('\n1. ')) {
					const items = section.split('\n').filter(item => item.trim());
					html += '<ol>';
					items.forEach(item => {
						const formattedItem = item.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').trim();
						if (formattedItem.match(/^\d+\.\s/)) {
							html += `<li>${formattedItem.replace(/^\d+\.\s/, '')}</li>`;
						} else if (formattedItem) {
							html += `<p>${formattedItem}</p>`;
						}
					});
					html += '</ol>';
				} 
				// ƒêo·∫°n vƒÉn th√¥ng th∆∞·ªùng
				else {
					const formattedSection = section.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').trim();
					if (formattedSection) {
						html += `<p>${formattedSection}</p>`;
					}
				}
			});

			return html;
		}

		function openNewCategoryModal() {
			const categoryName = prompt("Nh·∫≠p t√™n Category m·ªõi:");
			
			if (!categoryName) return; // Ng∆∞·ªùi d√πng b·∫•m h·ªßy ho·∫∑c kh√¥ng nh·∫≠p g√¨
			
			if (prompts[categoryName]) {
				alert("Category n√†y ƒë√£ t·ªìn t·∫°i!");
				return;
			}

			prompts[categoryName] = {}; // T·∫°o category m·ªõi r·ªóng
			localStorage.setItem("prompts", JSON.stringify(prompts));
			renderPrompts();
		}


		function closeCategoryModal() {
			document.getElementById('category-modal').style.display = "none";
		}

		function saveNewCategory() {
			const categoryName = document.getElementById("new-category-name").value.trim();
			if (!categoryName) {
				alert("Vui l√≤ng nh·∫≠p t√™n Category!");
				return;
			}

			if (prompts[categoryName]) {
				alert("Category n√†y ƒë√£ t·ªìn t·∫°i!");
				return;
			}

			prompts[categoryName] = {}; // T·∫°o category m·ªõi r·ªóng
			localStorage.setItem("prompts", JSON.stringify(prompts));
			renderPrompts();
			closeCategoryModal();
		}



		function editPrompt(event, category, key) {
			event.stopPropagation();
			document.getElementById('content-section').style.display = "none";
			document.getElementById('editor-section').style.display = "block";
			
			document.getElementById('new-category').value = category;
			document.getElementById('new-title').value = key;
			document.getElementById('new-description').value = prompts[category][key].description;
			document.getElementById('new-tips').value = prompts[category][key].tips;
			document.getElementById('new-content').value = prompts[category][key].content;
		}

		
        function showPrompt(category, key) {
			document.getElementById('editor-section').style.display = "none";
			document.getElementById('content-section').style.display = "block";

			document.getElementById('prompt-title').innerText = key;
			document.getElementById("prompt-title").setAttribute("data-category", category);
			document.getElementById('category-overview').classList.add("hidden");
			document.getElementById('prompt-description').innerText = prompts[category][key]?.description || "No description available.";
			document.getElementById('prompt-description').classList.remove("hidden");
			document.getElementById('prompt-tips').innerText = prompts[category][key]?.tips || "";
			document.getElementById('prompt-tips').classList.remove("hidden");
			document.querySelector('.button-group-row').classList.remove("hidden");

			const promptContent = document.getElementById('prompt-content');
			promptContent.value = prompts[category][key]?.content || "No content available.";
			promptContent.classList.remove("hidden");

			adjustTextareaHeight(); // G·ªçi h√†m t·ª± ƒë·ªông m·ªü r·ªông `textarea`
		}


		// ƒê·∫£m b·∫£o textarea lu√¥n ƒëi·ªÅu ch·ªânh ƒë√∫ng k√≠ch th∆∞·ªõc khi c·ª≠a s·ªï thay ƒë·ªïi
		window.addEventListener("resize", adjustTextareaHeight);

        function openNewPromptEditor() {
			document.getElementById('content-section').style.display = "none";
			document.getElementById('editor-section').style.display = "block";

			document.getElementById('new-title').value = "";
			document.getElementById('new-description').value = "";
			document.getElementById('new-tips').value = "";
			document.getElementById('new-content').value = "";

			updateCategoryDropdown(); // C·∫≠p nh·∫≠t danh s√°ch category khi m·ªü form
		}

		function deletePrompt(event, category, key) {
			event.stopPropagation();
			if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a "${key}" trong category "${category}"?`)) {
				delete prompts[category][key];

				// N·∫øu category kh√¥ng c√≤n prompt n√†o, x√≥a lu√¥n category
				if (Object.keys(prompts[category]).length === 0) {
					delete prompts[category];
				}

				localStorage.setItem("prompts", JSON.stringify(prompts));
				renderPrompts();
			}
		}

		
		function copyPrompt() {
            const text = document.getElementById('prompt-content');
            text.select();
            navigator.clipboard.writeText(text.value).then(() => {
                alert('Prompt copied!');
            });
        }
		
        function savePrompt() {
			const category = document.getElementById("new-category").value.trim();
			const title = document.getElementById("new-title").value.trim();
			const description = document.getElementById("new-description").value.trim();
			const tips = document.getElementById("new-tips").value.trim();
			const content = document.getElementById("new-content").value.trim();

			if (!category || !title) {
				alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Category v√† Prompt Title!");
				return;
			}

			if (!prompts[category]) {
				prompts[category] = {}; // T·∫°o category m·ªõi n·∫øu ch∆∞a t·ªìn t·∫°i
			}

			prompts[category][title] = { description, tips, content };
			localStorage.setItem("prompts", JSON.stringify(prompts));
			renderPrompts();
			showPrompt(category, title);
		}
		
		function updateCategoryDropdown() {
			const categoryDropdown = document.getElementById("new-category");
			categoryDropdown.innerHTML = '<option value="">-- Select a Category --</option>'; // X√≥a & reset

			Object.keys(prompts).forEach(category => {
				let option = document.createElement("option");
				option.value = category;
				option.textContent = category;
				categoryDropdown.appendChild(option);
			});
		}

		function autoResizeTextArea(textarea) {
			textarea.style.height = "auto"; // Reset chi·ªÅu cao ƒë·ªÉ t√≠nh to√°n ƒë√∫ng
			textarea.style.height = textarea.scrollHeight + "px"; // ƒê·∫∑t chi·ªÅu cao b·∫±ng n·ªôi dung th·ª±c t·∫ø
		}
		
		function openSaveAsEditor() {
			updateCategoryDropdown(); // C·∫≠p nh·∫≠t danh s√°ch category tr∆∞·ªõc khi m·ªü editor
			
			let promptTitle = document.getElementById("prompt-title").innerText;
			let promptContent = document.getElementById("prompt-content").value;
			let promptDescription = document.getElementById("prompt-description").innerHTML || "";
			let promptTips = document.getElementById("prompt-tips").innerHTML || "";

			if (!promptContent.trim()) {
				alert("Kh√¥ng c√≥ n·ªôi dung ƒë·ªÉ l∆∞u!");
				return;
			}
			
			// L·∫•y category hi·ªán t·∫°i c·ªßa prompt
			let currentCategory = document.getElementById("prompt-title").getAttribute("data-category") || "";
			

			// ·∫®n ph·∫ßn n·ªôi dung ch√≠nh v√† hi·ªán c·ª≠a s·ªï ch·ªânh s·ª≠a
			document.getElementById("content-section").style.display = "none";
			document.getElementById("editor-section").style.display = "block";

			// ƒêi·ªÅn n·ªôi dung t·ª´ textarea v√† description, tips v√†o editor
			document.getElementById("new-title").value = promptTitle + " (Copy)";
			document.getElementById("new-content").value = promptContent;
			document.getElementById("new-description").value = stripHtmlTags(promptDescription);
			document.getElementById("new-tips").value = stripHtmlTags(promptTips);

			// Ch·ªçn Category hi·ªán t·∫°i
			let categoryDropdown = document.getElementById("new-category");
			if (currentCategory && categoryDropdown.querySelector(`option[value="${currentCategory}"]`)) {
				categoryDropdown.value = currentCategory;
			}
	
			// T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu cao c·ªßa c√°c textarea
			autoResizeTextArea(document.getElementById("new-content"));
			autoResizeTextArea(document.getElementById("new-description"));
			autoResizeTextArea(document.getElementById("new-tips"));

			// T·∫°o s·ª± ki·ªán l∆∞u prompt
			let saveButton = document.querySelector(".save-btn");
			saveButton.onclick = function () {
				saveAsPrompt();
			};
		}

		// H√†m lo·∫°i b·ªè th·∫ª HTML ƒë·ªÉ ch·ªâ l·∫•y n·ªôi dung vƒÉn b·∫£n
		function stripHtmlTags(html) {
			let doc = new DOMParser().parseFromString(html, "text/html");
			return doc.body.textContent || "";
		}

		function saveAsPrompt() {
			const category = document.getElementById("new-category").value.trim();
			const title = document.getElementById("new-title").value.trim();
			const description = document.getElementById("new-description").value.trim();
			const tips = document.getElementById("new-tips").value.trim();
			const content = document.getElementById("new-content").value.trim();

			if (!category || !title) {
				alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Category v√† Prompt Title!");
				return;
			}

			if (!prompts[category]) {
				prompts[category] = {}; // T·∫°o category m·ªõi n·∫øu ch∆∞a t·ªìn t·∫°i
			}
			
			// Ki·ªÉm tra xem prompt ƒë√£ t·ªìn t·∫°i ch∆∞a
			if (prompts[category][title]) {
				if (!confirm(`Prompt "${title}" ƒë√£ t·ªìn t·∫°i trong "${category}". B·∫°n c√≥ mu·ªën ghi ƒë√® kh√¥ng?`)) {
					return;
				}
			}

			// Th√™m prompt m·ªõi v√†o danh s√°ch
			prompts[category][title] = { description, tips, content };

			// L∆∞u v√†o localStorage
			localStorage.setItem("prompts", JSON.stringify(prompts));

			alert(`Prompt "${title}" ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng v√†o "${category}"!`);

			// C·∫≠p nh·∫≠t danh s√°ch prompt
			renderPrompts();

			// Hi·ªÉn th·ªã prompt m·ªõi
			showPrompt(category, title);
		}

		function adjustTextareaHeight() {
			const promptContent = document.getElementById("prompt-content");

			if (!promptContent) return; // ƒê·∫£m b·∫£o kh√¥ng l·ªói n·∫øu ph·∫ßn t·ª≠ ch∆∞a c√≥

			promptContent.style.height = "auto"; // ƒê·∫∑t l·∫°i height ƒë·ªÉ tr√°nh sai s·ªë
			promptContent.style.height = promptContent.scrollHeight + "px"; // C·∫≠p nh·∫≠t theo n·ªôi dung th·ª±c t·∫ø
		}

		function openPromptLib() {
			alert("Ch·ª©c nƒÉng PromptLib ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn!");
		}
		
		async function updatePromptsFromOnline() {
			try {
				const response = await fetch(JSON_URL);
				if (!response.ok) throw new Error("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu t·ª´ PromptLib!");

				const newData = await response.json();
				let updated = false; // Ki·ªÉm tra xem c√≥ prompt n√†o ƒë∆∞·ª£c c·∫≠p nh·∫≠t kh√¥ng

				// Duy·ªát qua t·ª´ng category trong JSON m·ªõi
				Object.keys(newData).forEach(category => {
					if (!prompts[category]) {
						prompts[category] = {}; // N·∫øu category ch∆∞a t·ªìn t·∫°i, t·∫°o m·ªõi
					}

					// Duy·ªát qua t·ª´ng prompt trong category
					Object.keys(newData[category]).forEach(promptKey => {
						if (!prompts[category][promptKey]) {
							// N·∫øu prompt ch∆∞a c√≥ trong c·ª•c b·ªô, th√™m v√†o
							prompts[category][promptKey] = newData[category][promptKey];
							updated = true;
						} else {
							// N·∫øu prompt ƒë√£ c√≥, c·∫≠p nh·∫≠t n·ªôi dung
							prompts[category][promptKey] = newData[category][promptKey];
							updated = true;
						}
					});
				});

				if (updated) {
					localStorage.setItem("prompts", JSON.stringify(prompts)); // L∆∞u v√†o localStorage
					renderPrompts(); // C·∫≠p nh·∫≠t giao di·ªán
					alert("C·∫≠p nh·∫≠t th√†nh c√¥ng c√°c Prompt t·ª´ PromptLib!");
				} else {
					alert("Kh√¥ng c√≥ Prompt n√†o ƒë∆∞·ª£c c·∫≠p nh·∫≠t.");
				}
			} catch (error) {
				console.error("L·ªói khi t·∫£i d·ªØ li·ªáu PromptLib:", error);
				alert("L·ªói khi c·∫≠p nh·∫≠t PromptLib. Vui l√≤ng th·ª≠ l·∫°i sau!");
			}
		}

    </script>
</body>
</html>
